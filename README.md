# geocmp

CLI утилита для визуального сравнения GeoJSON-файлов.

## Описание

`geocmp` генерирует автономный HTML-файл с интерактивной картой, позволяющий быстро переключаться между несколькими GeoJSON-документами для их визуального сравнения. Все данные встраиваются в единый HTML-файл, который можно открыть в браузере без подключения к интернету (кроме загрузки карты OSM и библиотек Leaflet).

## Возможности

- Визуализация нескольких GeoJSON-файлов на одной карте
- Быстрое переключение между слоями с помощью вкладок или горячих клавиш
- Поддержка glob-паттернов для указания файлов
- Автоматическое применение стилей из свойств GeoJSON (marker-color, fill, stroke и т.д.)
- Popup с информацией о свойствах объектов при клике
- Сохранение позиции карты в URL (lat, lng, zoom)
- Полностью автономный HTML-файл

## Установка

```bash
# Используя uv (рекомендуется)
uv pip install -e .

# Или используя pip
pip install -e .
```

## Использование

### Базовое использование

```bash
# Сравнить два GeoJSON файла
geocmp file1.geojson file2.geojson

# Вывести результат в файл
geocmp -o output.html file1.geojson file2.geojson

# Использовать glob-паттерны
geocmp "*.geojson"
geocmp "data/**/*.geojson"
```

### Опции командной строки

```
positional arguments:
  args                  Список входных GeoJSON-файлов (поддерживает glob-паттерны)

options:
  -h, --help            Показать справку
  -v, --verbose         Включить подробное логирование (DEBUG)
  -o OUT, --out OUT     Путь к файлу для сохранения результата (по умолчанию stdout)
  --title TITLE         Заголовок HTML-документа (по умолчанию формируется автоматически)
  --ext_css EXT_CSS     Путь к дополнительному CSS-файлу
  --ext_js EXT_JS       Путь к дополнительному JS-файлу
```

### Примеры

```bash
# Вывести HTML в stdout
geocmp data/region1.geojson data/region2.geojson

# Сохранить в файл с подробным логированием
geocmp -v -o comparison.html region*.geojson

# Установить свой заголовок
geocmp --title "Сравнение регионов" -o map.html region1.geojson region2.geojson

# Использовать рекурсивный поиск
geocmp -o all_data.html "data/**/*.geojson"
```

## Управление интерактивной картой

После открытия сгенерированного HTML-файла в браузере доступны следующие возможности:

### Переключение между слоями

- **Клик по вкладке** - переключиться на соответствующий слой
- **Клавиши 1-9, 0** - переключиться на слой по номеру (1 = первый слой, 0 = десятый слой)
- **Клавиша T (или Е)** - циклическое переключение на следующий слой

### Работа с картой

- **Левая кнопка мыши + перетаскивание** - перемещение карты
- **Колесо мыши** - приближение/отдаление
- **Клик по объекту** - показать popup с информацией о свойствах
- **Позиция карты сохраняется в URL** - можно делиться ссылкой с нужным zoom и центром

## Формат данных

### Поддерживаемые GeoJSON структуры

Утилита работает с GeoJSON документами типа `FeatureCollection`:

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [37.6, 55.75]
      },
      "properties": {
        "name": "Москва",
        "marker-color": "#ff0000"
      }
    }
  ]
}
```

### Поддерживаемые свойства стилизации

Утилита автоматически применяет стили из следующих свойств объектов:

- `marker-color` - цвет маркера/линии
- `fill` - цвет заливки
- `stroke` - цвет обводки
- `fill-opacity` - прозрачность заливки
- `stroke-width` - толщина обводки
- `marker-size` - размер маркера (small/medium/large)
- `radius` - радиус маркера в пикселях

Пример с стилями:

```json
{
  "type": "Feature",
  "geometry": {
    "type": "Polygon",
    "coordinates": [[...]]
  },
  "properties": {
    "name": "Зона А",
    "fill": "#00ff00",
    "fill-opacity": 0.5,
    "stroke": "#006600",
    "stroke-width": 2
  }
}
```

## Требования

- Python >= 3.9
- Стандартная библиотека Python (нет внешних зависимостей для работы утилиты)
- Браузер с поддержкой JavaScript для просмотра результата

## Разработка

### Установка для разработки

```bash
# Установить с зависимостями для разработки
uv pip install -e ".[dev]"

# Или используя dependency groups (uv)
uv pip install -e . --group dev
```

### Запуск тестов

```bash
pytest
```

### Форматирование кода

```bash
black src/geocmp/
```

## Структура проекта

```
src/
└── geocmp/
    ├── __init__.py          - Пакет
    ├── __main__.py          - Точка входа CLI
    ├── cli.py               - CLI интерфейс (Typer)
    ├── geojson_tools.py     - Валидация и стилизация GeoJSON
    ├── glob_expander.py     - Обработка glob-паттернов
    ├── html_maker.py        - Генерация HTML
    ├── i18n.py              - Интернационализация
    ├── utils.py             - Вспомогательные функции
    └── templates/           - Шаблоны для HTML
        ├── template.html    - HTML-шаблон
        ├── style.css        - Стили карты
        └── map.js           - Логика карты и переключения слоев
```

## Лицензия

MIT

## Автор

Your Name <your.email@example.com>
